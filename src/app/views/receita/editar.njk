{% extends "_layouts/default.njk" %} 

{% block body %}
  <div class="row"> 
    <main role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4" id="main">  
      <div class="cadastro">
        <h3>Editar Receita</h3>
        <br>
        <form action="/receita/editar/{{ receita._id }}" method="POST" enctype="multipart/form-data" id="formPost">          
          <div class="row">
            <div class="col-md-8 col-lg-6">
              <img src="/files/{{receita.imgReceita}}" class="card-img-top" id="imgReceita" alt="...">
            </div>  
          </div>  

          <div class="row">
            <div class="col-md-8 col-lg-6">
              <div class="form-group">
                <label for="nome">Nome</label>
                <input type="text" name="nome" id="nomeReceita" placeholder="Nome" value="{{ receita.nome }}" maxlength="50" class="form-control" required>
              </div>
            </div>
          </div> 
          <div class="row">
            <div class="col-md-6 col-lg-4">
              <div class="form-group">
                <label for="imgReceita">
                  <img src="/assets/img/avatar.svg" height="24">
                </label>
                <input id="imgReceita" name="imgReceita" type="file">
              </div>
            </div>
          </div>

          <div>
            <a class="btn btn-primary col-xl-2 col-lg-3 col-md-4" href="#" role="button" id="btnAdicionar">Adicionar Ingrediente</a>
          </div>

          <div id="itens">
            {% for itemReceita in itensReceita %}
              <div class="row">
                <div class="col-md-2 col-lg-2 col-xl-1"> 
                  <label for="quantidade">Quantidade</label>
                  <input type="number" step="0.01" name="qtdeInsumo" value="{{ itemReceita.qtdeInsumo }}" class="qtde form-control" min="0.01" required>
                </div>
                <div class="col-md-4 col-lg-4 col-xl-4">
                  <label for="medida">Medida</label>
                  <select name="medida" class="medidas form-control">
                  </select>
                </div>
                <div class="col-md-3 col-lg-4 col-xl-4">
                  <label for="insumo">Insumo</label>
                  <select name="insumo" class="selectInsumos form-control">       
                  </select>
                </div>
                <div class="col-md-2 col-lg-2 col-xl-3 divBtnExcluirVenda">
                  <input type="button" name="btnExcluir" value="X" class="btnExcluir btn btn-danger mt-4">
                </div>  
              </div>
            {% else %}
              <h4 class="mt-3 error" >Não há itens para exibir nessa receita </h4>
            {% endfor %}
          </div>

          <div class="row">
            <div class="col-md-12 col-lg-12">
              <div class="form-group">
                <label for="modoPreparo">Modo de Preparo</label>
                <textarea id="modoPreparo" name="modoPreparo" rows="20" cols="100" class="form-control" required>{{ receita.modoPreparo }}</textarea>
              </div>
            </div>
          </div> 

          <div class="row">
            <div class="col-md-12 col-lg-12">
              <div class="form-group">
                <label for="obs">Obs:</label>
                <textarea id="obs" name="obs" rows="10" cols="100" class="form-control">{{ receita.obs }}</textarea> 
              </div>
            </div>
          </div> 

          <div class="row">
            <div class="col-xl-3 col-lg-3 col-md-3">
              <div class="form-group">
                <label for="qtdeRendimento">Quantidade de Porções</label>
                <input type="number" name="qtdeRendimento"  step="0.01" class="form-control" value="{{ receita.qtdeRendimento }}" min="0.01" max="100" required>
              </div>
            </div>
            <div class="col-md-1">
            </div>
            <div class="col-xl-3 col-lg-3 col-md-3">
              <div class="form-group">
                <label for="tempoPreparo">Tempo de Preparo</label>
                <input type="time" name="tempoPreparo" class="form-control" value="{{ receita.tempoPreparo }}" required>
              </div>
            </div>
            <div class="col-md-1">
            </div>
            <div class="col-xl-3 col-lg-3 col-md-3 ">
              <div class="form-group">
                <label for="categoriaReceita">Categoria</label>
                <select name="categoriaReceita" id="selectCategorias" class="form-control">
                </select>
              </div>
            </div>
          </div>

          <hr class="my-4"> 
          <h5> Preço Médio</h5>
          <div class="row">
            <div class="col-xl-3 col-lg-3 col-md-3">
              <div class="form-group">
                <label for="valorMedioPorcao">Porção</label>
                <input type="number" name="valorMedioPorcao"  step="0.01" class="form-control" id="valorMedioPorcao" value="{{ valorMedioPorcao }}" readOnly>
              </div>
            </div>

            <div class="col-xl-3 col-lg-3 col-md-3" id="dtVlMedioEdit">
              <div class="form-group">
                <label for="valorMedio">Receita</label>
                <input type="number" name="valorMedio"  step="0.01" class="form-control" id="valorMedio" value="{{ valorMedio }}" readOnly>
              </div>
            </div>
            <div class="col-xl-3 col-lg-3 col-md-3" id="dtCalculoEdit">
              <div class="form-group">
                <label for="dtCalculoPrecoMedio">Data do Cálculo</label>
                <input type="text" name="dtCalculoPrecoMedio" class="flatpickr form-control" id="dtCalculoPrecoMedio" value="{{ dataReceita }}" readOnly>
              </div>
            </div>
            <div class="col-xl-3 col-lg-3 col-md-3" id="divBtnPrecoMedio">
              <div class="form-group">
                <input type="button" class="form-control btn btn-primary mt-4" id="btnPrecoMedio" value="Calcular">
              </div>
            </div>    
          </div>

          <div class="row">
            <div class="col-xl-4 col-lg-4 col-md-4">
              <div class="form-group">
                <p id="CompraNula" class="ErrorField" style="display:none;"></p>
              </div>
            </div>
          </div>  
          <hr class="my-4"> 

          <p class="hidden" id="idHidden">{{ receita._id }}</p>

          <div class="row col error">
            <div class="alert alert-danger">É necessário adicionar um item para realizar a gravação</div>
          </div> 

          <button type="submit" class="btn btn-primary col-xl-2 col-lg-3 col-md-4 mt-2" id="btnGravar" disabled>Confirmar</button>

          <a class="btn btn-primary col-xl-2 col-lg-3 col-md-4 btnVoltar mt-2" href="/receita/listar" role="button">Voltar</a>
         

          <select class="hidden" id="insumosReceita">
            {% for insumo in insumos %}
              <option value="{{ insumo._id }}" name="receita" class="itemInsumo"> {{ insumo.nome }}</option>
            {% endfor %}
          </select>

          <select class="hidden" id="medidasHidden">
            <option value="Colher Cha" class="qtdeInsumo">Colher de Chá</option>
            <option value="Colher Sopa" class="qtdeInsumo">Colher de Sopa</option>
            <option value="Copo" class="qtdeInsumo">Copo</option>
            <option value="Duzia" class="qtdeInsumo">Dúzia(s)</option>
            <option value="G" class="qtdeInsumo">Gramas</option>
            <option value="KG" class="qtdeInsumo">KG</option>
            <option value="L" class="qtdeInsumo">Litro(s)</option>
            <option value="MG" class="qtdeInsumo">MG</option>
            <option value="ML" class="qtdeInsumo">ML</option>
            <option value="Unidade" class="qtdeInsumo">Unidade(s)</option>
            <option value="Xicara" class="qtdeInsumo">Xícara(s)</option>
          </select>

          <select class="hidden" id="receitasItem">
            {% for IdReceitaItens in vetIdReceitaItens %}
              <option value="{{IdReceitaItens}}" ></option>
            {% endfor %}
          </select>

          <select class="hidden">
            {% for categoriaReceita in categoriasReceita %}
              <option value="{{categoriaReceita._id}}" class="categoriasReceita">{{categoriaReceita.categoria}}</option>
            {% endfor %}
          </select>

          <select class="hidden">
            {% for itemReceita in itensReceita %}
              <option value="{{itemReceita.medida}}" class="medidaItem"></option>
            {% endfor %}
          </select>

          <input type="number" value="{{ controle }}" id="controle" style="display:none;"> 
          <input type="text" value="{{ receita.categoriaReceita }}" id="idCategoria" style="display:none;"> 
        </form>
      </div>
      </main>
  </div> 

  <script src="/assets/js/functions/funcoesReceita.js"></script>

{% endblock%} 
    