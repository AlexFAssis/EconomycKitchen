{% extends "_layouts/default.njk" %} 

{% block body %}
  <div class="row"> 
    <main role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4" id="main"> 
      <div class="cadastro">
        <h3>Editar Venda</h3>
        <br>
        <form action="/venda/editar/{{ venda._id }}" method="POST">

          <div class="row">
            <div class="col-md-4 col-lg-3 col-xl-2">
              <div class="form-group">
                <label for="data">Data</label>
                <input type="text" name="data" id="dtVenda" value="{{dataVenda}}" class="flatpickr form-control" required>
              </div>
            </div>
            <div class="col-md-4 col-lg-3 col-xl-2">
              <div class="form-group">
                <label for="usuario">Usuário</label>
                <select name="usuario" class="form-control selectUsuarios">
                </select> 
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-4 col-lg-3 col-xl-2">
              <div class="form-group">
                <label for="metodoPagamento">Método de Pagamento</label>
                <select  name="metodoPagamento" class="selectMetodo form-control" id="mtdoPagto">
                  <option value="{{ venda.metodoPagamento }}" id="optionMetodoPgto" > {{ venda.metodoPagamento }}</option>
                </select>
              </div>
            </div>
            <div class="col-md-4 col-lg-3 col-xl-2">
              <div class="form-group">
                <label for="qtdeParcelas">Quantidade de Parcelas</label>
                <input type="number" name="qtdeParcelas" id="qtdeParcelas" value="{{venda.qtdeParcelas}}" class="form-control" maxlength="2" min="1" max="12"> 
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-4 col-lg-3 col-xl-2">
              <div class="form-group">
                <label for="valor">Valor</label>
                <div class="input-group">
                  <div class="input-group-prepend">    
                    <span class="input-group-text" id="input1">R$</span>
                  </div>
                  <input type="text" id="vlVenda" class="form-control" name="valorTotal" value='{{venda.valorTotal}}' data-thousands="." data-decimal=","  min="0.01" readonly/>
                </div>
              </div>
            </div>
            <div class="col-md-4 col-lg-3 col-xl-2">
              <div class="form-group">
                <label for="desconto">Desconto</label>
                <input type="text" class="form-control" value="{{venda.desconto}}" id="desconto" name="desconto" data-thousands="." data-decimal="," />
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-4 col-lg-3 col-xl-2">
                <p id="erroDesconto" class="ErrorField" style="display:none;"></p>          
            </div>
          </div>

          <div class="row" id="error">
            <div class="col-md-3">
              {% include "_partials/flash.njk" %}
            </div>
          </div> 

          <a class="btn btn-primary mb-2 col-md-4 col-lg-3 col-xl-2" href="#" role="button" id="btnAdicionar">Adicionar Item</a>

          <div id="itens">
            {% for itemVenda in itensVenda %}
                <div class="row">
                    <div class="col-xl-5 col-lg-6 col-md-6">
                      <label for="produto">Produto</label>
                      <select name="produto" class="Prod form-control">
                      </select>
                    </div> 
                    <div class="col-md-2">
                      <label for="quantidade">Quantidade</label>
                      <input type="number" step="0.01" name="quantidade" value="{{ itemVenda.quantidade }}" class="qtde form-control" min="0.01" required>
                    </div>
                    <div class="col-md-3">
                      <label for="valor">Valor Un.</label>
                      <div class="input-group">
                        <div class="input-group-prepend">    
                          <span class="input-group-text" id="input2">R$</span>
                        </div>
                        <input type="text" class="vl form-control" name="valor" value='{{ itemVenda.valor }}' data-thousands="." data-decimal=","  min="0.01" readonly/>
                      </div> 
                    </div> 
                    <div class="col-md-1 divBtnExcluirVenda">
                      <input type="button" name="btnExcluir" value="X" class="btnExcluir btn btn-danger mt-4" >
                    </div>  
                </div>  
            {% else %}
                <h4 class="mt-3">Não há itens para exibir nessa venda </h4>
            {% endfor %}
          </div>
              
          <button type="submit" class="btn btn-primary col-md-4 col-lg-3 col-xl-2 mt-4">Confirmar</button>     
          <a class="btn btn-primary col-md-4 col-lg-3 col-xl-2 mt-4 btnVoltar"  href="/venda/listar" role="button">Voltar</a>

          <select class="hidden">
            {% for produto in produtos %}
              <option value="{{ produto._id }}" class="precoProduto" > {{ produto.preco }}</option>
            {% endfor %}
          </select>

          <select class="hidden" id="idProdHidden">
            {% for produto in produtos %}
              <option value="{{ produto._id }}" class="itemVenda"> {{ produto.receita.nome }}</option>
            {% endfor %}
          </select>

          <select class="hidden" id="produtosVenda">
            {% for IdProdutos in vetIdProdutos %}
              <option value="{{IdProdutos}}" ></option>
            {% endfor %}
          </select>

          <select class="hidden" id="mtdoPagtoHidden">
            <option value="Dinheiro" name="metodoPagamento">Dinheiro</option>
            <option value="Credito" name="metodoPagamento">Cartão de Crédito</option>
            <option value="Debito" name="metodoPagamento">Cartão de Débito</option>
          </select>

          <select class="hidden" id="users">
            {% for usuario in usuarios %}
              <option value="{{ usuario._id }}" name="usuario">{{ usuario.nome }}</option>
            {% endfor %} 
          </select>

          <input type="text" value="{{venda.usuario}}" id="idUsuario" style="display:none;"> 
          <input type="number" value="{{ controle }}" id="controle" style="display:none;"> 
        </form>
      </div>
      </main>
  </div> 

  <script src="/assets/js/functions/funcoesVenda.js"></script>

{% endblock%} 